---
- name: Install PostgreSQL
  ansible.builtin.apt:
    name: postgresql
    state: present

- name: Ensure PostgreSQL data directory exists
  ansible.builtin.file:
    path: /var/lib/postgresql
    state: directory
    owner: postgres
    group: postgres
    mode: '0755'

- name: Ensure PostgreSQL config directory exists
  ansible.builtin.file:
    path: /etc/postgresql
    state: directory
    owner: postgres
    group: postgres
    mode: '0755'

- name: Start and enable PostgreSQL
  ansible.builtin.service:
    name: postgresql
    state: started
    enabled: true

- name: Create homelab_paas database
  community.postgresql.postgresql_db:
    db: homelab_paas
    login_user: postgres
    state: present

- name: Create dashboard user
  community.postgresql.postgresql_user:
    name: dashboard
    password: "{{ dashboard_db_password | default('dashboard123') }}"
    login_user: postgres
    state: present
    role_attr_flags: LOGIN
